<!DOCTYPE html>
<html lang="en">
<head>
    <title>EonX Docs</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&display=swap" rel="stylesheet">
    <script defer src="https://kit.fontawesome.com/955de18180.js" crossorigin="anonymous"></script>

                <link id="theme-style" rel="stylesheet" href="https://eonx-com.github.io/packages.eonx.com/assets/css/theme.css">
    

    <link id="theme-style" rel="stylesheet" href="/assets/css/prism.css">
</head>
<body>



<div class="page-header theme-bg-dark py-5 text-center position-relative">
    <div class="theme-bg-shapes-right"></div>
    <div class="theme-bg-shapes-left"></div>
    <div class="container">
        <h1 class="page-heading single-col-max mx-auto">
            <img class="logo-icon mr-2"
                 src="https://39cszd96rb9jntgd3r2cirij-wpengine.netdna-ssl.com/wp-content/uploads/2019/09/eonx-logo@1x.png"
                 alt="logo">
        </h1>
        <h1 class="page-heading single-col-max mx-auto">Documentation</h1>
                                                            </div>
</div><!--//page-header-->
<div class="page-content">
    <div class="container">
        <div class="docs-overview py-5">
            <div class="row">
                    <div class="col-12">
        <div align="center">
    <h1>EonX - EasySecurity</h1>
    <p>Provides security features to be generic across applications.</p>
</div>
<hr />
<p>This document describes the steps to install this package in a <a href="https://symfony.com">Symfony</a> application.</p>
<h1>Dependencies</h1>
<p>This package has dependencies on the following packages, please see their documentation directly:</p>
<ul>
<li><a href="https://github.com/eonx-com/easy-api-token">EasyApiToken</a></li>
<li><a href="https://github.com/eonx-com/easy-psr7-factory">EasyPsr7Factory</a></li>
</ul>
<h1>Require package (Composer)</h1>
<p>Laravel uses <a href="https://github.com/eonx-com/easy-api-token">Composer</a> to manage its dependencies. You can require this package as following:</p>
<pre><code class="language-bash">$ composer require eonx/easy-security</code></pre>
<h1>Register Bundle</h1>
<p>If your application doesn't use Symfony Flex then you will have to register the bundle yourself:</p>
<pre><code class="language-php">// config/bundles.php

return [
    // Other bundles ...

    EonX\EasySecurity\Bridge\Symfony\EasySecurityBundle::class =&gt; ['all' =&gt; true]
];</code></pre>
<h1>Getting Started</h1>
<h2>Create Context and ContextFactory</h2>
<p>This package provides you built-in features to resolve a security context specific to your application, to do so it
needs to know about the Context class and how to create it (via your ContextFactory).</p>
<h3>Context</h3>
<p>You application MUST define a Context class (you can name it whatever you want but come on.. let's be consistent!).
This class MUST somehow implement <code>Eonx\EasySecurity\Interfaces\ContextInterface</code>. This package provides a base <code>Context</code>
class and here are our recommendation in term of implementation:</p>
<ul>
<li>Create a <code>ContextInterface</code> interface which extends <code>Eonx\EasySecurity\Interfaces\ContextInterface</code></li>
<li>Create a <code>Context</code> class which extends <code>Eonx\EasySecurity\Context</code> and implements your <code>ContextInterface</code></li>
</ul>
<p>This way when you migrate to PHP7.4, you will be able to use <a href="https://www.php.net/manual/en/language.oop5.variance.php">Covariance</a>!</p>
<pre><code class="language-php">// src/Security/Interfaces/ContextInterface.php
namespace App\Security;

use Eonx\EasySecurity\Interfaces\ContextInterface as BaseContextInterface;

interface ContextInterface extends BaseContextInterface 
{
    // Override methods and return types here...
}

// src/Security/Context.php
namespace App\Security;

use App\Security\ContextInterface;
use Eonx\EasySecurity\Context as BaseContext;

final class Context extends BaseContext implements ContextInterface
{
    // Override methods and return types here...
}</code></pre>
<h3>ContextFactory</h3>
<p>Once you've defined your <code>Context</code> and <code>ContextInterface</code>, you'll need to tell the package how to instantiate your
it using a... <code>ContextFactory</code>! This package provides you with the <code>EonX\EasySecurity\Interfaces\ContextFactoryInterface</code>
you just have to do the implementation:</p>
<pre><code class="language-php">// src/Security/Factories/ContextFactory.php

namespace App\Security\Factories;

use App\Security\Interfaces\ContextInterface;
use EonX\EasySecurity\Interfaces\ContextFactoryInterface;
use EonX\EasySecurity\Interfaces\Resolvers\ContextResolvingDataInterface;

final class ContextFactory implements ContextFactoryInterface
{
    public function create(ContextResolvingDataInterface $data): ContextInterface
    {
        return new Context($data-&gt;getApiToken(), $data-&gt;getRoles(), $data-&gt;getProvider(), $data-&gt;getUser());
    }
}</code></pre>
<h3>Register ContextFactory as Service</h3>
<p>For this package to be able to use your context factory you need to register it as a service under
<code>EonX\EasySecurity\Interfaces\ContextFactoryInterface</code>:</p>
<pre><code class="language-yaml"># config/services.yaml

services:
    # Other services...

    EonX\EasySecurity\Interfaces\ContextFactoryInterface: '@App\Security\Factories\ContextFactory'</code></pre>
<h2>Context Data Providers</h2>
<h3>User and Provider Interfaces</h3>
<p>This package defines <code>EonX\EasySecurity\Interfaces\UserInterface</code> and <code>EonX\EasySecurity\Interfaces\ProviderInterface</code>.
Those interfaces are really basic so this package can work with a large panel of applications having different user and
provider objects. Same as <code>Context</code> and its interface you will use <a href="https://www.php.net/manual/en/language.oop5.variance.php">Covariance</a>.</p>
<p>The only thing you need to make sure is that the objects your application will provide to the context resolver are
implementing those interfaces.</p>
<h3>Providers</h3>
<p>This package handles all the generic tasks as decoding api token from request, fetch user id from api token, ...
All the application's specific logic is delegated to your application, logic isn't it!? To tell the package how to
retrieve the object specific to your application you will use what we call &quot;providers&quot;, this package provides the following interfaces:</p>
<ul>
<li><code>EonX\EasySecurity\Interfaces\ProviderProviderInterface</code>: Provides the <code>Provider</code> instance</li>
<li><code>EonX\EasySecurity\Interfaces\UserProviderInterface</code>: Provides the <code>User</code> instance</li>
<li><code>EonX\EasySecurity\Interfaces\RolesProviderInterface</code>: Provides the list of <code>Role</code> instances</li>
</ul>
<p>Your job is to create an implementation for each provider and register it as service.</p>
<pre><code class="language-php">// src/Security/Providers/UserProvider.php

namespace App\Security\Providers;

use App\Repository\UserRepositoryInterface;
use EonX\EasySecurity\Interfaces\UserInterface;
use EonX\EasySecurity\Interfaces\UserProviderInterface;

final class UserProvider implements UserProviderInterface
{
    /**
     * @var \App\Repository\UserRepositoryInterface
     */
     private $userRepo;

    /**
     * UserProvider constructor.
     *
     * @param \App\Repository\UserRepositoryInterface $userRepo
     */
     public function __construct(UserRepositoryInterface $userRepo)
     {
        $this-&gt;userRepo = $userRepo;
     }

     /**
      * Get user for given uniqueId and data.
      *
      * @param int|string $uniqueId
      * @param mixed[] $data
      *
      * @return null|\EonX\EasySecurity\Interfaces\UserInterface
      */
      public function getUser($uniqueId, array $data): ?UserInterface
      {
          $user = $this-&gt;userRepo-&gt;findOneByExternalId($uniqueId);

          $user-&gt;setFirstName($data['fn'] ?? null);
          $user-&gt;setLastName($data['ln'] ?? null);
          $user-&gt;setExternalId($uniqueId);

          return $user;
      }
}</code></pre>
<pre><code class="language-php">// src/Security/Providers/ProviderProvider.php 

namespace App\Security\Providers;

use App\Repository\ProviderRepositoryInterface;
use EonX\EasySecurity\Interfaces\ProviderInterface;
use EonX\EasySecurity\Interfaces\ProviderProviderInterface;

final class ProviderProvider implements ProviderProviderInterface
{
    /**
     * @var \App\Repository\ProviderRepositoryInterface
     */
    private $providerRepo;

    /**
     * ProviderProvider constructor.
     *
     * @param \App\Repository\ProviderRepositoryInterface $providerRepo
     */
    public function __construct(ProviderRepositoryInterface $providerRepo)
    {
        $this-&gt;providerRepo = $providerRepo;
    }

    /**
     * Get provider for given uniqueId.
     *
     * @param int|string $uniqueId
     *
     * @return null|\EonX\EasySecurity\Interfaces\ProviderInterface
     */
    public function getProvider($uniqueId): ?ProviderInterface
    {
        return $this-&gt;providerRepo-&gt;findOne($uniqueId);
    }
}</code></pre>
<pre><code class="language-php">// src/Security/Providers/InMemoryRolesProvider.php

namespace App\Security\Providers;

use App\Security\Interfaces\PermissionsInterface;
use App\Security\Interfaces\RolesInterface;
use EonX\EasySecurity\Role;
use EonX\EasySecurity\RolesProviders\AbstractInMemoryRolesProvider;

final class InMemoryRolesProvider extends AbstractInMemoryRolesProvider
{
    /**
     * Init roles.
     *
     * @return \EonX\EasySecurity\Interfaces\RoleInterface[]
     */
    protected function initRoles(): array
    {
        return [
            new Role(RolesInterface::ROLE_SUPER_ADMIN, [
                PermissionsInterface::CATEGORY_CREATE,
                // Other permissions...
            ])
        ];
    }
}</code></pre>
<pre><code class="language-yaml"># config/services.yaml

services:
    # Other services...

    EonX\EasySecurity\Interfaces\ProviderProviderInterface: '@App\Security\Providers\ProviderProvider'
    EonX\EasySecurity\Interfaces\UserProviderInterface: '@App\Security\Providers\UserProvider'
    EonX\EasySecurity\Interfaces\RolesProviderInterface: '@App\Security\Providers\InMemoryRolesProvider'</code></pre>
<h3>Data Resolvers</h3>
<p>This package uses data resolvers to resolve the context data, it comes with built-in resolvers you can re-use or you
have the possibility to create your own by implementing <code>EonX\EasySecurity\Interfaces\Resolvers\ContextDataResolverInterface</code>.
Done! It will be automatically injected into the context resolver. If you need some resolvers to be executed in a specific
order you can use the <code>getPriority(): int</code> method to do so, the smallest priority will be executed first.</p>
<p>To use the built-in context data resolvers you just need to register them in your services config:</p>
<pre><code class="language-yaml"># config/services.yaml

services:
    # Other services...

    EonX\EasySecurity\Resolvers\RolesFromJwtDataResolver: ~
    EonX\EasySecurity\Resolvers\ProviderFromJwtDataResolver: ~
    EonX\EasySecurity\Resolvers\ProviderFromHeaderDataResolver: ~
    EonX\EasySecurity\Resolvers\UserFromJwtDataResolver: ~</code></pre>
<h3>Configure Bundle</h3>
<p>You need to tell the package to use your context interface as service id for the context, this way it will allow you
to use dependency injection with your own context interface!</p>
<pre><code class="language-yaml"># config/packages/easy_security.yaml

easy_security:
    context_service_id: App\Security\Interfaces\ContextInterface</code></pre>
<h3>Symfony Firewall and Authenticator</h3>
<p>You're nearly there! The last step is to configure Symfony Security component to use all your previous work:</p>
<pre><code class="language-yaml"># config/packages/security.yaml

security:
    firewalls:
        # Other firewalls...

        main:
            pattern: ^/.+
            stateless: true
            anonymous: false
            guard:
                authenticators:
                    - EonX\EasySecurity\Bridge\Symfony\Security\ContextAuthenticator</code></pre>
<p>And you're done! Enjoy!</p>
    </div>
            </div><!--//row-->
        </div><!--//container-->
    </div><!--//container-->
</div><!--//page-content-->

<section class="cta-section text-center py-5 theme-bg-dark position-relative">
    <div class="theme-bg-shapes-right"></div>
    <div class="theme-bg-shapes-left"></div>
    <div class="container">
        <h3 class="mb-2 text-white mb-3">
            We start where other loyalty and payment providers end.
            Contact us to start your EonX journey!
        </h3>
        <div class="pt-3 text-center">
            <a class="btn btn-light" href="https://eonx.com/contact">
                Contact <i class="fas fa-arrow-alt-circle-right ml-2"></i>
            </a>
        </div>
    </div>
</section><!--//cta-section-->


<footer class="footer">
    <div class="footer-bottom text-center py-5">
                                                                
        <!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can buy the commercial license via our website: themes.3rdwavemedia.com */-->
        <small class="copyright">Designed with <i class="fas fa-heart" style="color: #fb866a;">
            </i> by <a class="theme-link" href="http://themes.3rdwavemedia.com" target="_blank">Xiaoying Riley</a> for
            developers
        </small>
    </div>

</footer>

</body>
        <script src="https://eonx-com.github.io/packages.eonx.com/assets/js/jquery-3.4.1.min.js"></script>
    <script src="https://eonx-com.github.io/packages.eonx.com/assets/js/jquery.scrollTo.min.js"></script>
    <script src="https://eonx-com.github.io/packages.eonx.com/assets/js/popper.min.js"></script>
    <script src="https://eonx-com.github.io/packages.eonx.com/assets/js/bootstrap.min.js"></script>


    <script>
        $('pre').addClass('line-numbers');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
    <script src="/assets/js/prism.js"></script>
</html>
